---
/**
 * ReadingProgress.astro
 * Barra de progreso de lectura que se llena mientras el usuario scrollea
 */
---

<div id="reading-progress" class="reading-progress-bar"></div>

<script is:inline>
  function updateReadingProgress() {
    var progressBar = document.getElementById('reading-progress');
    if (!progressBar) return;

    // Calcular el progreso de scroll
    var windowHeight = window.innerHeight;
    var documentHeight = document.documentElement.scrollHeight;
    var scrollTop = window.scrollY || document.documentElement.scrollTop;
    
    // Calcular porcentaje (0-100)
    var scrollable = documentHeight - windowHeight;
    var scrolled = scrollTop;
    var progress = (scrolled / scrollable) * 100;
    
    // Actualizar ancho de la barra
    progressBar.style.width = Math.min(progress, 100) + '%';
  }

  // Actualizar en scroll con throttle para performance
  var ticking = false;
  window.addEventListener('scroll', function() {
    if (!ticking) {
      window.requestAnimationFrame(function() {
        updateReadingProgress();
        ticking = false;
      });
      ticking = true;
    }
  });

  // Inicializar cuando DOM esté listo
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', updateReadingProgress);
  } else {
    updateReadingProgress();
  }
  
  // Soporte para view transitions de Astro
  document.addEventListener('astro:page-load', updateReadingProgress);
</script>

<style>
  .reading-progress-bar {
    position: fixed;
    top: 0;
    left: 0;
    height: 4px;
    background: linear-gradient(90deg, #F4B942, #75AADB);
    width: 0%;
    z-index: 9999;
    transition: width 0.1s ease-out;
    box-shadow: 0 2px 8px rgba(244, 185, 66, 0.4);
  }
  
  /* Animación de glow al completar */
  .reading-progress-bar[style*="100%"] {
    box-shadow: 0 0 20px rgba(244, 185, 66, 0.8);
  }
</style>
