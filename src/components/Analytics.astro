<script>
  async function logPageView() {
    // Bot detection
    if (navigator.webdriver) return;

    try {
      const payload = {
        type: "page_view",
        path: window.location.pathname,
        title: document.title,
        referrer: document.referrer || "",
        screenSize: `${window.innerWidth}x${window.innerHeight}`
      };

      // Send to Secure Backend (Vercel API)
      await fetch('/api/analytics', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      });
      
      if (import.meta.env.DEV) {
        console.log("Analytics: Page view logged securely");
      }

    } catch (e) {
      console.error("Analytics Error:", e);
    }
  }

  // Run on load and on client-side navigation
  logPageView();
  document.addEventListener('astro:page-load', logPageView);
</script>
