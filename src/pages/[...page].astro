---
// Component Imports
import BaseHead from '../components/BaseHead.astro';
import BlogHeader from '../components/BlogHeader.astro';
import BlogPostPreview from '../components/BlogPostPreview.astro';
import Footer from '../components/Footer.astro';
import { SITE } from '../config';

// --- MAGIA DE PAGINACI√ìN (Astro) ---
export async function getStaticPaths({ paginate }) {
  let allPosts = await Astro.glob('./posts/*.md');
  allPosts = allPosts.sort((a, b) => new Date(b.frontmatter.publishDate).valueOf() - new Date(a.frontmatter.publishDate).valueOf());
  const popularPosts = allPosts.slice(0, 3);

  return paginate(allPosts, { 
      pageSize: 12,
      props: { popularPosts }
  });
}

const { page, popularPosts } = Astro.props;

let title = 'Tu blog viajero - InstanteTrips';
let description = 'Vive la magia del destino: sabores, paisajes y momentos √∫nicos. Evita los errores de novato con estrategias reales.';
let permalink = 'https://blog.instantetrips.com/';
---

<html lang="es">
    <head>
        <BaseHead {title} {description} {permalink} />

        
<style is:global>
  /* Todo tu CSS aqu√≠ */
  :root {
    --bg-body: #0b1116;
    ...
  }
  
  body {
    background-color: var(--bg-body);
    ...
  }
  
  /* ... resto de tus estilos ... */
</style>
    </head>

    <body>
        <BlogHeader />
        
        <div class="wrapper">
            <header class="hero-compact">
                <div class="overlay-gradient"></div>
                <div class="hero-content">
                    <span class="hero-tagline">BLOG DE VIAJES</span>
                    <h1 class="hero-title-main">INSTANTE TRIPS <span style="font-weight:400; color:#F4B942;">&</span> TIPS</h1>
                </div>
            </header>

            <div class="main-container-centered">
                <main class="content">
                    <div class="ad-container-horizontal">
                        <img 
                            src="https://placehold.co/728x90/75AADB/ffffff?text=OFERTA+VUELOS+INTERNACIONALES+-40%25" 
                            alt="Anuncio" 
                            class="ad-banner-img"
                        />
                    </div>

                    <div class="page-container">
                        <div class="main-content">
                            <section aria-label="√öltimos art√≠culos">
                                <div class="grid-layout" id="postsGrid">
                                    {page.data.map((p) => (
                                        <div class="post-item-wrapper"> 
                                            <BlogPostPreview post={p} />
                                        </div>
                                    ))}
                                    <div id="no-results">
                                        <p>Ups, no encontramos nada aqu√≠. ü§∑‚Äç‚ôÇÔ∏è</p>
                                    </div>
                                </div>
                            </section>

                            <nav class="pagination-wrapper">
                                {page.url.prev ? <a href={page.url.prev} class="nav-btn">‚Üê Anterior</a> : <div style="width: 120px;"></div>}
                                <span class="page-count">{page.currentPage} / {page.lastPage}</span>
                                {page.url.next ? <a href={page.url.next} class="nav-btn">Siguiente ‚Üí</a> : <div style="width: 120px;"></div>}
                            </nav>
                        </div>

                        <aside class="sidebar">
                            <div class="sidebar-widget">
                                <h3 class="widget-title">Quienes somos</h3>
                                <p class="sidebar-text">Instante Trips and Tips es un blog para viajeros reales basado en experiencia directa.</p>
                            </div>
                            <div class="sidebar-widget">
                                <h3 class="widget-title">Explorar</h3>
                                <input type="text" id="searchInput" class="search-input" placeholder="Buscar..." onkeyup="searchPosts()">
                                <div class="tags-cloud">
                                    <button class="cat-btn active" onclick="filterPosts('all')">Todo</button>
                                    <button class="cat-btn" onclick="filterPosts('europa')">Europa</button>
                                    <button class="cat-btn" onclick="filterPosts('comida')">Comida</button>
                                </div>
                            </div>
                            <div class="sidebar-widget">
                                <h3 class="widget-title">M√°s Le√≠dos</h3>
                                <ul style="list-style: none; padding: 0; margin: 0;">
                                    {popularPosts.map((p) => (
                                        <li style="margin-bottom: 1rem;">
                                            <div class="popular-item">
                                                <a href={p.url}>
                                                    <img src={p.frontmatter.heroImage || p.frontmatter.heroImageLink} class="mini-thumb" alt="" />
                                                    <span class="mini-title">{p.frontmatter.title}</span>
                                                </a>
                                            </div>
                                        </li>
                                    ))}
                                </ul>
                            </div>
                        </aside>
                    </div>
                </main>
            </div> 
        </div>

        <Footer />
        
        <script is:inline>
            function searchPosts() {
                let input = document.getElementById('searchInput').value.toLowerCase();
                let cards = document.getElementsByClassName('post-item-wrapper');
                let hasResults = false;
                for (let i = 0; i < cards.length; i++) {
                    let textContent = cards[i].innerText.toLowerCase();
                    if (textContent.includes(input)) { cards[i].style.display = "flex"; hasResults = true; }
                    else { cards[i].style.display = "none"; }
                }
                document.getElementById('no-results').style.display = hasResults ? "none" : "block";
            }
            function filterPosts(category) {
                document.getElementById('searchInput').value = category === 'all' ? '' : category;
                searchPosts();
            }
        </script>
    </body>
</html>